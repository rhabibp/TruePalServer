<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipient Field Test</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-button {
            margin: 10px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .test-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        .test-result {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
        }
        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="test-info">
        <h2>Recipient Field Test</h2>
        <p>This test verifies that the recipient name field appears correctly when selecting "Stock Out" in the transaction modal.</p>
        <p><strong>Expected behavior:</strong></p>
        <ul>
            <li>When transaction type is "Stock In" or "Adjustment": Recipient field should be hidden</li>
            <li>When transaction type is "Stock Out": Recipient field should be visible and required</li>
        </ul>
    </div>

    <button class="test-button" onclick="showTransactionModal()">Open Transaction Modal</button>
    <button class="test-button" onclick="runAutomatedTest()">Run Automated Test</button>

    <div id="test-results"></div>

    <!-- Transaction Modal -->
    <div id="transaction-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="transaction-modal-title">New Transaction</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="transaction-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="transaction-part">Part *</label>
                        <select id="transaction-part" required>
                            <option value="1">Test Part (TP001) - Stock: 10</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transaction-type">Type *</label>
                        <select id="transaction-type" required>
                            <option value="IN">Stock In</option>
                            <option value="OUT">Stock Out</option>
                            <option value="ADJUSTMENT">Adjustment</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transaction-quantity">Quantity *</label>
                        <input type="number" id="transaction-quantity" required>
                    </div>
                    <div class="form-group">
                        <label for="transaction-price">Unit Price</label>
                        <input type="number" id="transaction-price" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="transaction-recipient">Recipient Name</label>
                        <input type="text" id="transaction-recipient">
                    </div>
                    <div class="form-group">
                        <label for="transaction-reason">Reason</label>
                        <input type="text" id="transaction-reason">
                    </div>
                    <div class="form-group">
                        <label for="transaction-amount-paid">Amount Paid</label>
                        <input type="number" id="transaction-amount-paid" step="0.01" value="0">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="transaction-is-paid"> Fully Paid
                        </label>
                    </div>
                    <div class="form-group full-width">
                        <label for="transaction-notes">Notes</label>
                        <textarea id="transaction-notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Transaction</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Initialize form enhancements (copied from modals.js)
        function initFormEnhancements() {
            // Show/hide recipient field based on transaction type
            const transactionType = document.getElementById('transaction-type');
            const recipientInput = document.getElementById('transaction-recipient');
            
            if (transactionType && recipientInput) {
                // Find the parent form group by traversing up from the input
                const recipientGroup = recipientInput.closest('.form-group');
                
                const toggleRecipientField = () => {
                    const isOutTransaction = transactionType.value === 'OUT';
                    if (recipientGroup) {
                        recipientGroup.style.display = isOutTransaction ? 'flex' : 'none';
                    }
                    recipientInput.required = isOutTransaction;
                };
                
                transactionType.addEventListener('change', toggleRecipientField);
                toggleRecipientField(); // Initial call
            }
        }

        function showTransactionModal() {
            document.getElementById('transaction-modal').classList.add('show');
            initFormEnhancements();
        }

        function closeModal() {
            document.getElementById('transaction-modal').classList.remove('show');
        }

        function runAutomatedTest() {
            const resultsDiv = document.getElementById('test-results');
            const results = [];
            
            // Show modal and initialize
            showTransactionModal();
            
            const transactionType = document.getElementById('transaction-type');
            const recipientInput = document.getElementById('transaction-recipient');
            const recipientGroup = recipientInput.closest('.form-group');
            
            // Test 1: Stock In - recipient should be hidden
            transactionType.value = 'IN';
            transactionType.dispatchEvent(new Event('change'));
            
            const isHiddenForIn = recipientGroup.style.display === 'none';
            const isNotRequiredForIn = !recipientInput.required;
            
            results.push({
                test: 'Stock In - Recipient field hidden',
                passed: isHiddenForIn && isNotRequiredForIn,
                details: `Display: ${recipientGroup.style.display}, Required: ${recipientInput.required}`
            });
            
            // Test 2: Stock Out - recipient should be visible and required
            transactionType.value = 'OUT';
            transactionType.dispatchEvent(new Event('change'));
            
            const isVisibleForOut = recipientGroup.style.display === 'flex';
            const isRequiredForOut = recipientInput.required;
            
            results.push({
                test: 'Stock Out - Recipient field visible and required',
                passed: isVisibleForOut && isRequiredForOut,
                details: `Display: ${recipientGroup.style.display}, Required: ${recipientInput.required}`
            });
            
            // Test 3: Adjustment - recipient should be hidden
            transactionType.value = 'ADJUSTMENT';
            transactionType.dispatchEvent(new Event('change'));
            
            const isHiddenForAdjustment = recipientGroup.style.display === 'none';
            const isNotRequiredForAdjustment = !recipientInput.required;
            
            results.push({
                test: 'Adjustment - Recipient field hidden',
                passed: isHiddenForAdjustment && isNotRequiredForAdjustment,
                details: `Display: ${recipientGroup.style.display}, Required: ${recipientInput.required}`
            });
            
            // Display results
            const allPassed = results.every(r => r.passed);
            const resultClass = allPassed ? 'success' : 'error';
            const resultTitle = allPassed ? '✓ All Tests Passed!' : '✗ Some Tests Failed';
            
            resultsDiv.innerHTML = `
                <div class="test-result ${resultClass}">
                    <h3>${resultTitle}</h3>
                    ${results.map(r => `
                        <div>
                            <strong>${r.passed ? '✓' : '✗'} ${r.test}</strong><br>
                            <small>${r.details}</small>
                        </div>
                    `).join('<br>')}
                </div>
            `;
            
            closeModal();
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeModal();
            }
        });
    </script>
</body>
</html>